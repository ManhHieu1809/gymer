<!DOCTYPE html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="Gym Template">
    <meta name="keywords" content="Gym, unica, creative, html">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gym | Template</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Muli:300,400,500,600,700,800,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Oswald:300,400,500,600,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Css Styles -->
    <link th:href="@{/css2/bootstrap.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/font-awesome.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/flaticon.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/owl.carousel.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/barfiller.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/magnific-popup.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/slicknav.min.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/css2/style.css}" rel="stylesheet" type="text/css">
    <!-- Favicon-->
    <link th:href="@{/assets3/favicon.ico}" rel="icon" type="image/x-icon">
     <!-- Bootstrap icons-->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
     <!-- Core theme CSS (includes Bootstrap)-->
     <link th:href="@{css3/styles.css}" rel="stylesheet" />
     <style>
       /* Căn chỉnh phần User icon và Login/Signup trong header */

/* Căn chỉnh biểu tượng người dùng */
.user-icon {
    font-size: 2rem;
    color: white; /* Màu trắng cho icon */
    text-decoration: none;
    margin-right: 10px; /* Khoảng cách giữa icon và login/signup */
}

.user-icon:hover {
    color: #007bff; /* Màu khi hover */
}

/* Căn chỉnh các liên kết login/signup */
.auth-links a {
    text-decoration: none;
    color: white; /* Màu trắng */
    font-weight: bold;
    margin-left: 0px;
}

.auth-links a:hover {
    color: #007bff; /* Màu khi hover */
}

/* Thêm hiệu ứng cho các liên kết */
.login-btn, .signup-btn {
    text-transform: uppercase; /* Viết hoa cho các liên kết */
}
     </style>

</head>

<body>
    <!-- Page Preloder -->
    <div id="preloder">
        <div class="loader"></div>
    </div>

    <!-- Offcanvas Menu Section Begin -->
    <div class="offcanvas-menu-overlay"></div>
    <div class="offcanvas-menu-wrapper">
        <div class="canvas-close">
            <i class="fa fa-close"></i>
        </div>
       
        <nav class="canvas-menu mobile-menu">
            <ul>
                <li><a href="/customer/home">Home</a></li>
                <li><a href="/customer/home/nutrition-plan">Kế hoạch dinh dưỡng</a></li>
                <li><a href="/customer/home/workout-plan">Kế hoạch luyện tập</a></li>
                <li><a href="/customer/home/Progress">Tiến độ luyện tập</a></li>
                <li><a href="/customer/home/shop">Shop</a></li>
                <li><a href="/customer/home/users/notification">Thông báo</a></li>
                <li><a href="/customer/home/chat">Chăm sóc khách hàng</a></li>
                <li><a href="/customer/home/chat">Contact</a></li>
            </ul>
        </nav>
    </div>
    <!-- Offcanvas Menu Section End -->

   <!-- Header Section Begin -->
<header class="header-section">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-3">
                <div class="logo">
                    <a href="/customer/home">
                        <img th:src="@{/img/logo.png}" alt="">
                    </a>
                </div>
            </div>
            <div class="col-lg-6">
                <nav class="nav-menu">
                    <ul>
                        <li><a href="/customer/home">Home</a></li>
                        <li><a href="/customer/home/nutrition-plan">Kế hoạch dinh dưỡng</a></li>
                        <li><a href="/customer/home/workout-plan">Kế hoạch luyện tập</a></li>
                        <li><a href="/customer/home/Progress">Tiến độ luyện tập</a></li>
                        <li class="active"><a href="/customer/home/shop">Shop</a></li>
                        <li><a href="/customer/home/users/notification">Thông báo</a></li>
                        <li><a href="/customer/home/chat">Chăm sóc khách hàng</a></li>
                    </ul>
                </nav>
                
            </div>

            <div class="col-lg-3">
                <!-- User Icon and Login/Signup Links -->
                <div class="d-flex justify-content-end align-items-center">
                    <a href="/customer/home/users" class="user-icon" id="user-icon">
                        <i class="fa fa-user"></i>
                    </a>
                    <div class="auth-links ml-3" id="auth-links">
                        <a href="/req/login" class="login-btn" id="login-btn">Login</a> |
                        <a href="/req/signup" class="signup-btn">Signup</a>
                    </div>
                    <div class="user-info text-white" id="user-info" style="display: none;">
                        <span>Welcome, <span id="username"></span>!</span>
                    </div>
                </div>
            </div>

        </div>
        <div class="canvas-open">
            <i class="fa fa-bars"></i>
        </div>
    </div>
</header>
<!-- Header End -->

    <!-- Hero Section Begin -->
    <section class="hero-section">
        <div class="hs-slider owl-carousel">
            <div class="hs-item set-bg" th:data-setbg="@{/img/hero/hero-1.jpg}">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12 text-center">
                            <div class="breadcrumb-text">
                                <h2>SHOP GYM</h2>
                                <div class="bt-option">
                                    <a href="/customer/home">Home</a>
                                    <a href="#">SHOP GYM</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Classes Section Begin -->
    <section class="classes-section spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <h2>SHOP GYM</h2>
                    </div>
                </div>
                <!-- Container chứa thanh tìm kiếm và nút giỏ hàng -->
                <div class="d-flex justify-content-end align-items-center position-absolute top-50 translate-middle-y" style="right: 10px; z-index: 1050;">
                    <!-- Thanh tìm kiếm -->
                    <form class="d-flex me-3" id="search-form">
                        <input class="form-control me-2" type="search" placeholder="Search for products" aria-label="Search" id="search-input">
                        <button class="btn btn-outline-secondary" type="submit">Search</button>
                    </form>
                    <!-- Nút giỏ hàng -->
                    <form>
                        <button class="btn btn-light shadow position-relative me-3" type="button" id="cart-icon">
                            <i class="bi-cart-fill me-1"></i> Cart
                            <span id="cart-count" class="badge bg-dark text-white ms-1 rounded-pill">0</span>
                        </button>
                    </form>
                </div>


            </div>

            <!-- Phần hiển thị kết quả -->
            <div id="search-results" class="mt-3">

            </div>


            <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center" id="product-container">
                <!-- sản phẩm -->
            </div>

            <div class="d-flex justify-content-center mt-4" id="pagination-container">
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <!-- Các nút phân trang sẽ được thêm động -->
                    </ul>
                </nav>
            </div>

        </div>
    </section>
    <!-- ChoseUs Section End -->


    <!-- Footer Section Begin -->
    <section class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <div class="fs-about">
                        <div class="fa-logo">
                            <a href="#"><img th:src="@{/img/logo.png}" alt=""></a>
                        </div>
                        <p>“Con đường dẫn đến thành công được làm nên từ những viên gạch của sự kiên trì. Hãy là chính mình, vượt qua mọi chướng ngại và theo đuổi ước mơ của bản thân.”</p>
                        <div class="fa-social">
                            <a href="#"><i class="fa fa-facebook"></i></a>
                            <a href="#"><i class="fa fa-twitter"></i></a>
                            <a href="#"><i class="fa fa-youtube-play"></i></a>
                            <a href="#"><i class="fa fa-instagram"></i></a>
                            <a href="#"><i class="fa  fa-envelope-o"></i></a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="fs-widget">
                        <h4>Useful links</h4>
                        <ul>
                            <li><a href="#">About</a></li>
                            <li><a href="#">Blog</a></li>
                            <li><a href="#">Classes</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-6">
                    <div class="fs-widget">
                        <h4>Support</h4>
                        <ul>
                            <li><a href="#">Login</a></li>
                            <li><a href="#">My account</a></li>
                            <li><a href="#">Subscribe</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="fs-widget">
                        <h4>Tips & Guides</h4>
                        <div class="fw-recent">
                            <h6><a href="#">Physical fitness may help prevent depression, anxiety</a></h6>
                            <ul>
                                <li>3 min read</li>
                                <li>20 Comment</li>
                            </ul>
                        </div>
                        <div class="fw-recent">
                            <h6><a href="#">Fitness: The best exercise to lose belly fat and tone up...</a></h6>
                            <ul>
                                <li>3 min read</li>
                                <li>20 Comment</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12 text-center">
                    
                </div>
            </div>
        </div>
    </section>
    <!-- Footer Section End -->



    <!-- Js Plugins -->
    <script th:src="@{/js2/jquery-3.3.1.min.js}"></script>
    <script th:src="@{/js2/bootstrap.min.js}"></script>
    <script th:src="@{/js2/jquery.magnific-popup.min.js}"></script>
    <script th:src="@{/js2/masonry.pkgd.min.js}"></script>
    <script th:src="@{/js2/jquery.barfiller.js}"></script>
    <script th:src="@{/js2/jquery.slicknav.js}"></script>
    <script th:src="@{/js2/owl.carousel.min.js}"></script>
    <script th:src="@{/js2/main.js}"></script>
    <!-- Core theme JS-->
    <script th:src="@{/js3/scripts.js}"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const productContainer = document.getElementById("product-container");
            const paginationContainer = document.getElementById("pagination-container");
            const cartCount = document.getElementById("cart-count");
            const cartIcon = document.getElementById("cart-icon");

            let currentPage = 0; // Trang hiện tại
            const pageSize = 8;  // Số sản phẩm trên mỗi trang

            // Lấy giỏ hàng từ localStorage hoặc khởi tạo mảng trống
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            // Hàm cập nhật số lượng sản phẩm trong giỏ hàng
            const updateCartCount = () => {
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCount.textContent = totalItems;
            };

            // Hàm định dạng giá tiền
            const formatPrice = (price) => {
                return new Intl.NumberFormat('vi-VN').format(price) + ' VNĐ';
            };

            // Hàm fetch API lấy sản phẩm
            const fetchProducts = (page) => {
                fetch(`/customer/home/users/page?page=${page}&size=${pageSize}`)
                    .then(response => response.json())
                    .then(data => {
                        const products = data.content; // Danh sách sản phẩm
                        const totalPages = data.totalPages; // Tổng số trang

                        // Xóa sản phẩm cũ
                        productContainer.innerHTML = "";

                        // Render sản phẩm
                        products.forEach(product => {
                            const productHTML = `
                    <div class="col mb-5">
                        <div class="card h-100 bg-dark text-white">
                            <img class="card-img-top" src="${product.imageUrl || 'https://via.placeholder.com/450x300'}" alt="${product.productName}" />
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <h5 class="fw-bolder">${product.productName}</h5>
                                    <span class="text-muted text-decoration-line-through">${formatPrice(product.price)}</span>
                                </div>
                            </div>
                            <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                                <div class="text-center d-flex justify-content-between">
                                    <a class="btn btn-outline-success mt-auto" href="/customer/home/shop/productDetail?id=${product.productID}">View Details</a>
                                    <button class="btn btn-outline-success mt-auto ms-2 add-to-cart-btn"
                                        data-id="${product.productID}"
                                        data-name="${product.productName}"
                                        data-price="${product.price}">
                                        Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                            productContainer.innerHTML += productHTML;
                        });

                        // Gán sự kiện "click" cho nút "Add to Cart"
                        document.querySelectorAll(".add-to-cart-btn").forEach(button => {
                            button.addEventListener("click", () => {
                                const productID = button.getAttribute("data-id");
                                const productName = button.getAttribute("data-name");
                                const productPrice = button.getAttribute("data-price");

                                // Kiểm tra nếu sản phẩm đã có trong giỏ hàng
                                const existingProduct = cart.find(item => item.id === productID);
                                if (existingProduct) {
                                    existingProduct.quantity++;
                                } else {
                                    // Thêm sản phẩm mới
                                    cart.push({
                                        id: productID,
                                        name: productName,
                                        price: parseFloat(productPrice),
                                        quantity: 1,
                                    });
                                }

                                // Lưu giỏ hàng vào localStorage
                                localStorage.setItem("cart", JSON.stringify(cart));

                                // Cập nhật số lượng giỏ hàng
                                updateCartCount();

                                // Sử dụng SweetAlert2 để thông báo
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Sản phẩm đã được thêm vào giỏ hàng!',
                                    text: `Đã thêm sản phẩm "${productName}" vào giỏ hàng.`,
                                    confirmButtonText: 'OK',
                                    confirmButtonColor: '#3085d6',
                                    timer: 3000 // Thời gian tự động đóng sau 3 giây
                                });
                            });
                        });

                        // Cập nhật phân trang
                        renderPagination(totalPages);
                    })
                    .catch(error => console.error("Error fetching products:", error));
            };

            const renderPagination = (totalPages) => {
                const paginationList = paginationContainer.querySelector(".pagination");
                paginationList.innerHTML = "";

                // Nút "Previous"
                const prevItem = document.createElement("li");
                prevItem.className = `page-item ${currentPage === 0 ? "disabled" : ""}`;
                prevItem.innerHTML = `
        <button class="page-link">Previous</button>
    `;
                prevItem.addEventListener("click", () => {
                    if (currentPage > 0) {
                        currentPage--;
                        fetchProducts(currentPage);
                    }
                });
                paginationList.appendChild(prevItem);

                // Các nút số trang
                for (let i = 0; i < totalPages; i++) {
                    const pageItem = document.createElement("li");
                    pageItem.className = `page-item ${i === currentPage ? "active" : ""}`;
                    pageItem.innerHTML = `
            <button class="page-link">${i + 1}</button>
        `;
                    pageItem.addEventListener("click", () => {
                        currentPage = i;
                        fetchProducts(currentPage);
                    });
                    paginationList.appendChild(pageItem);
                }

                // Nút "Next"
                const nextItem = document.createElement("li");
                nextItem.className = `page-item ${currentPage === totalPages - 1 ? "disabled" : ""}`;
                nextItem.innerHTML = `
        <button class="page-link">Next</button>
    `;
                nextItem.addEventListener("click", () => {
                    if (currentPage < totalPages - 1) {
                        currentPage++;
                        fetchProducts(currentPage);
                    }
                });
                paginationList.appendChild(nextItem);
            };


            // Sự kiện click vào biểu tượng giỏ hàng
            cartIcon.addEventListener("click", () => {
                window.location.href = "/customer/home/shop/cart";
            });

            // Cập nhật số lượng giỏ hàng khi tải trang
            updateCartCount();

            // Fetch sản phẩm lần đầu
            fetchProducts(currentPage);
        });


    </script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Hàm lấy và hiển thị tên người dùng
        async function fetchAndDisplayUsernames() {
            try {
                // Gửi yêu cầu GET tới API
                const response = await fetch('http://localhost:8080/customer/home/users/user-info1', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include' // Đảm bảo gửi cookie session
                });

                if (response.ok) {
                    const data = await response.json(); // Lấy dữ liệu JSON từ phản hồi
                    const username = data.username;

                    // Hiển thị tên người dùng và ẩn các liên kết login/signup
                    document.getElementById("auth-links").style.display = 'none'; // Ẩn "Login" và "Signup"
                    document.getElementById("user-info").style.display = 'block'; // Hiển thị tên người dùng
                    document.getElementById("username").innerText = username; // Cập nhật tên người dùng
                } else {
                    console.error("Error fetching username:", response.statusText);
                }
            } catch (error) {
                console.error("Error fetching username:", error);
            }
        }

        // Kiểm tra khi tải trang và gọi API
        fetchAndDisplayUsernames();
    });

</script>

<script>
    async function searchProduct(productName) {
        const apiUrl = `http://localhost:8080/customer/home/users/search/${encodeURIComponent(productName)}`;

        try {
            // Gửi yêu cầu GET đến API
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            });

            // Kiểm tra nếu phản hồi không thành công
            if (!response.ok) {
                throw new Error(`Error: ${response.status} - ${response.statusText}`);
            }

            // Chuyển đổi phản hồi sang JSON
            const data = await response.json();

            // Trả về kết quả
            console.log('Search Results:', data);
            return data;
        } catch (error) {
            console.error('Error fetching product:', error);
            throw error;
        }
    }

    // Xử lý sự kiện tìm kiếm
    const productContainer = document.getElementById('product-container');
    const searchResultsContainer = document.getElementById('search-results');
    const cartCount = document.getElementById("cart-count");
    const cartIcon = document.getElementById("cart-icon");


    // Lấy giỏ hàng từ localStorage hoặc khởi tạo mảng trống
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    // Hàm cập nhật số lượng sản phẩm trong giỏ hàng
    const updateCartCount = () => {
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        cartCount.textContent = totalItems;
    };
    
    document.getElementById('search-form').addEventListener('submit', async (event) => {
        event.preventDefault(); // Ngăn chặn tải lại trang mặc định

        const searchInput = document.getElementById('search-input').value.trim();

        if (!searchInput) {
            alert('Please enter a product name to search!');
            return;
        }

        try {
            const results = await searchProduct(searchInput);
            // Chỉ hiển thị sản phẩm tìm kiếm
            productContainer.innerHTML = ''; // Xóa sản phẩm cũ
            displaySearchResults(results);
        } catch (error) {
            console.error('Error during search:', error);
            alert('Failed to search for products. Please try again later.');
        }
    });

    function displaySearchResults(results) {
        if (results.length === 0) {
            productContainer.innerHTML = '<p>No products found.</p>';
            return;
        }

        // Render sản phẩm
        results.forEach(product => {
            const productHTML = `
            <div class="col mb-5">
                <div class="card h-100 bg-dark text-white">
                    <img class="card-img-top" src="${product.imageUrl || 'https://via.placeholder.com/450x300'}" alt="${product.name}" />
                    <div class="card-body p-4">
                        <div class="text-center">
                            <h5 class="fw-bolder">${product.productName}</h5>
                            <span class="text-muted text-decoration-line-through">${product.price} VNĐ</span>
                        </div>
                    </div>
                    <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                        <div class="text-center d-flex justify-content-between">
                            <a class="btn btn-outline-success mt-auto" href="/customer/home/shop/productDetail?id=${product.productID}">View Details</a>
                            <button class="btn btn-outline-success mt-auto ms-2 add-to-cart-btn"
                                        data-id="${product.productID}"
                                        data-name="${product.productName}"
                                        data-price="${product.price}">
                                        Add to Cart
                                    </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
            productContainer.innerHTML += productHTML;
        });

        // Gán sự kiện "click" cho nút "Add to Cart"
        document.querySelectorAll(".add-to-cart-btn").forEach(button => {
            button.addEventListener("click", () => {
                const productID = button.getAttribute("data-id");
                const productName = button.getAttribute("data-name");
                const productPrice = button.getAttribute("data-price");

                // Kiểm tra nếu sản phẩm đã có trong giỏ hàng
                const existingProduct = cart.find(item => item.id === productID);
                if (existingProduct) {
                    existingProduct.quantity++;
                } else {
                    // Thêm sản phẩm mới
                    cart.push({
                        id: productID,
                        name: productName,
                        price: parseFloat(productPrice),
                        quantity: 1,
                    });
                }

                // Lưu giỏ hàng vào localStorage
                localStorage.setItem("cart", JSON.stringify(cart));

                // Cập nhật số lượng giỏ hàng
                updateCartCount();

                // Sử dụng SweetAlert2 để thông báo
                Swal.fire({
                    icon: 'success',
                    title: 'Sản phẩm đã được thêm vào giỏ hàng!',
                    text: `Đã thêm sản phẩm "${productName}" vào giỏ hàng.`,
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#3085d6',
                    timer: 3000 // Thời gian tự động đóng sau 3 giây
                });
            });
        });
    }

</script>


</body>

</html>